import{y as D,z as $,r as h,j as a,S as F,T as w,h as _,B as N,b as E,m as k,x as Y,I as G}from"./index-DhQHNqrp.js";import{d as S}from"./dayjs.min-Tv9ClbJe.js";import"./es-DFQEj1rJ.js";import{a as W}from"./api-B5d2cEzN.js";import{u as L}from"./ToastContext-C4WtvxB4.js";import{M as O}from"./ModalWrapper-Cw9864jx.js";import{A as B}from"./Alert-dNxEE7vt.js";import{D as P,T as R}from"./DataGrid-DhyTyuOy.js";import"./ClickAwayListener-C8y_CwMB.js";import"./Chip-D9c2OCYE.js";import"./FormControlLabel-Bi2GVg1x.js";import"./TableCell-oRFRnvLi.js";var A={exports:{}};(function(j,M){(function(l,u){j.exports=u()})(D,function(){return function(l,u,m){l=l||{};var n=u.prototype,i={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function p(r,o,d,e){return n.fromToBase(r,o,d,e)}m.en.relativeTime=i,n.fromToBase=function(r,o,d,e,t){for(var c,v,C,s=d.$locale().relativeTime||i,x=l.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],z=x.length,b=0;b<z;b+=1){var g=x[b];g.d&&(c=e?m(r).diff(d,g.d,!0):d.diff(r,g.d,!0));var y=(l.rounding||Math.round)(Math.abs(c));if(C=c>0,y<=g.r||!g.r){y<=1&&b>0&&(g=x[b-1]);var T=s[g.l];t&&(y=t(""+y)),v=typeof T=="string"?T.replace("%d",y):T(y,o,g.l,C);break}}if(o)return v;var I=C?s.future:s.past;return typeof I=="function"?I(v):I.replace("%s",v)},n.to=function(r,o){return p(r,o,this,!0)},n.from=function(r,o){return p(r,o,this)};var f=function(r){return r.$u?m.utc():m()};n.toNow=function(r){return this.to(f(this),r)},n.fromNow=function(r){return this.from(f(this),r)}}})})(A);var q=A.exports;const H=$(q),V=({open:j,onClose:M,candidateId:l,vacancyId:u,candidateName:m})=>{const{showToast:n}=L(),[i,p]=h.useState(""),[f,r]=h.useState(""),[o,d]=h.useState(!1),[e,t]=h.useState(null),c=async()=>{if(!l||!u||!i||!f){t("Todos los campos son obligatorios.");return}d(!0),t(null);const s={id_afiliado:l,id_vacante:u,salario_final:i,tarifa_servicio:f};try{const x=await W.post("/hired",s);n(x.data.message||"Candidato marcado como contratado.","success"),v(!0)}catch(x){t(x.message||"No se pudo registrar la contratación."),n(x.message||"Error al registrar la contratación.","error")}finally{d(!1)}},v=(s=!1)=>{p(""),r(""),t(null),M(s)},C=[{label:"Cancelar",onClick:()=>v(!1),color:"inherit"},{label:"Confirmar Contratación",onClick:c,variant:"contained",color:"success",disabled:o,loading:o}];return a.jsx(O,{title:"Confirmar Contratación",open:j,onClose:()=>v(!1),actions:C,children:a.jsxs(F,{spacing:2.5,sx:{mt:1},children:[a.jsxs(w,{children:["Confirmando contratación para: ",a.jsx("strong",{children:m||"Candidato"})]}),a.jsx(w,{variant:"body2",color:"text.secondary",children:"Por favor, ingresa los detalles financieros para completar el registro."}),e&&a.jsx(B,{severity:"error",children:e}),a.jsx(_,{label:"Salario Final del Candidato",type:"number",fullWidth:!0,value:i,onChange:s=>p(s.target.value),placeholder:"Ej: 15000",autoFocus:!0,required:!0}),a.jsx(_,{label:"Tarifa del Servicio a Facturar",type:"number",fullWidth:!0,value:f,onChange:s=>r(s.target.value),placeholder:"Ej: 8000",required:!0})]})})};S.extend(H);S.locale("es");const ie=()=>{const[j,M]=h.useState([]),[l,u]=h.useState(!0),[m,n]=h.useState(null),[i,p]=h.useState({open:!1,candidateId:null,vacancyId:null,candidateName:null}),f=async()=>{u(!0),n(null);try{const e=await W.get("/interviews");M(e.data||[])}catch(e){console.error("Error al obtener las entrevistas:",e),n("No se pudieron cargar las entrevistas.")}finally{u(!1)}};h.useEffect(()=>{f()},[]);const r=(e,t,c)=>{p({open:!0,candidateId:e,vacancyId:t,candidateName:c})},o=(e=!1)=>{p({open:!1,candidateId:null,vacancyId:null,candidateName:null}),e&&f()},d=[{field:"nombre_candidato",headerName:"Candidato",flex:1.5,minWidth:180,renderCell:e=>a.jsx(E,{component:k,to:`/candidates/profile/${e.row.id_afiliado}`,size:"small",variant:"text",children:e.value})},{field:"cargo_vacante",headerName:"Vacante",flex:1.5,minWidth:180,renderCell:e=>a.jsx(E,{component:k,to:`/vacancies/${e.row.id_vacante}/pipeline`,size:"small",variant:"text",color:"secondary",children:e.value})},{field:"fecha_hora",headerName:"Fecha y Hora",flex:1.5,minWidth:220,renderCell:e=>{const t=S(e.value),c=t.isBefore(S());return a.jsxs(N,{children:[a.jsx(w,{variant:"body2",color:c?"text.secondary":"text.primary",children:t.format("dddd, D [de] MMMM, YYYY")}),a.jsxs(w,{variant:"caption",color:c?"text.secondary":"primary.main",children:[t.format("h:mm A")," (",t.fromNow(),")"]})]})}},{field:"entrevistador",headerName:"Entrevistador",flex:1,minWidth:150},{field:"actions",headerName:"Acciones",flex:1,minWidth:120,sortable:!1,align:"center",headerAlign:"center",renderCell:e=>a.jsx(R,{title:"Marcar como Contratado",children:a.jsx(Y,{color:"success",onClick:()=>r(e.row.id_afiliado,e.row.id_vacante,e.row.nombre_candidato),children:a.jsx(G,{icon:"fa6-solid:user-check"})})})}];return a.jsxs(a.Fragment,{children:[a.jsxs(N,{p:3.5,children:[a.jsx(F,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:a.jsx(w,{variant:"h4",children:"Gestión de Entrevistas"})}),m&&a.jsx(B,{severity:"error",sx:{mt:2,mb:2},children:m}),a.jsx(N,{sx:{height:"calc(100vh - 200px)",width:"100%"},children:a.jsx(P,{rows:j,columns:d,loading:l,getRowId:e=>e.id_entrevista,initialState:{pagination:{paginationModel:{page:0,pageSize:25}},sorting:{sortModel:[{field:"fecha_hora",sort:"desc"}]}},pageSizeOptions:[10,25,50],disableRowSelectionOnClick:!0})})]}),a.jsx(V,{open:i.open,onClose:o,candidateId:i.candidateId,vacancyId:i.vacancyId,candidateName:i.candidateName})]})};export{ie as default};
