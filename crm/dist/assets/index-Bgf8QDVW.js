import{r,j as e,I as o,B as m,g as w,i as W,F as V,w as k,x as q,M,v as C,l as _,h as F,z as O}from"./index-D8abmwow.js";import{a as I}from"./api-D_anxX8K.js";import{u as L}from"./ToastContext-CjgFWFeE.js";import{M as R}from"./ModalWrapper-CvEYGRpM.js";import{A}from"./Alert-r8BKkBx-.js";import{D as T}from"./DataGrid-j-PmfbUS.js";import{C as D}from"./Chip-CwgSXf8l.js";import"./ClickAwayListener-Dr6xD1wL.js";import"./FormControlLabel-7TmQE7HR.js";import"./TableCell-BC9tei3J.js";const u={"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"primary.main"},"&.Mui-focused fieldset":{borderWidth:"1px"}},"& .MuiInputLabel-root":{"&.Mui-focused":{color:"text.primary"}}},B=({open:x,onClose:b,onSuccess:f})=>{const{showToast:h}=L(),[c,p]=r.useState([]),[a,d]=r.useState({id_cliente:"",cargo_solicitado:"",ciudad:"",requisitos:"",salario:""}),[i,g]=r.useState(!1),[j,t]=r.useState(null);r.useEffect(()=>{x&&(async()=>{try{const n=await I.get("/clients");p(n.data||[])}catch(n){t("No se pudieron cargar los clientes."),console.error("Error al cargar clientes:",n)}})()},[x]);const l=s=>{const{name:n,value:S}=s.target;d(v=>({...v,[n]:S}))},E=s=>{d(n=>({...n,id_cliente:s.target.value}))},N=async()=>{var s,n;if(!a.id_cliente||!a.cargo_solicitado){t("El cliente y el cargo solicitado son obligatorios.");return}g(!0),t(null);try{await I.post("/vacancies",a),h("Vacante creada exitosamente.","success"),f(),y()}catch(S){const v=((n=(s=S.response)==null?void 0:s.data)==null?void 0:n.message)||"No se pudo crear la vacante.";t(v),h(`Error: ${v}`,"error")}finally{g(!1)}},y=()=>{d({id_cliente:"",cargo_solicitado:"",ciudad:"",requisitos:"",salario:""}),t(null),b()},z=[{label:"Cancelar",onClick:y,color:"inherit",variant:"text",startIcon:e.jsx(o,{icon:"mdi:close"})},{label:"Crear Vacante",onClick:N,variant:"contained",disabled:i||!a.id_cliente||!a.cargo_solicitado,loading:i,startIcon:e.jsx(o,{icon:"mdi:plus"})}],P=r.useMemo(()=>e.jsxs(m,{component:"div",display:"flex",alignItems:"center",children:[e.jsx(o,{icon:"mdi:briefcase-plus",sx:{mr:1.5,color:"primary.main"}}),e.jsx(w,{variant:"h6",component:"span",children:"Crear Nueva Vacante"})]}),[]);return e.jsx(R,{title:P,open:x,onClose:y,actions:z,maxWidth:"md",children:e.jsxs(W,{spacing:3,sx:{mt:1,p:1},children:[j&&e.jsx(A,{severity:"error",sx:{"& .MuiAlert-message":{width:"100%"},"& .MuiAlert-icon":{alignItems:"center"}},children:j}),e.jsxs(V,{fullWidth:!0,required:!0,sx:u,children:[e.jsx(k,{id:"client-select-label",children:"Cliente"}),e.jsx(q,{labelId:"client-select-label",value:a.id_cliente,label:"Cliente",onChange:E,disabled:c.length===0||i,fullWidth:!0,required:!0,sx:{"& .MuiSelect-select":{display:"flex",alignItems:"center"},"& .MuiListItemIcon-root":{minWidth:36}},children:c.length===0?e.jsx(M,{disabled:!0,children:"No hay clientes disponibles"}):c.map(s=>e.jsx(M,{value:s.id_cliente.toString(),sx:{py:1.5},children:e.jsxs(m,{display:"flex",alignItems:"center",children:[e.jsx(o,{icon:"mdi:office-building",sx:{mr:1.5,color:"text.secondary",fontSize:"1.25rem"}}),s.empresa]})},s.id_cliente))})]}),e.jsx(C,{required:!0,name:"cargo_solicitado",label:"Cargo Solicitado",fullWidth:!0,value:a.cargo_solicitado,onChange:l,disabled:i,sx:u,InputProps:{startAdornment:e.jsx(o,{icon:"mdi:account-tie",sx:{mr:1.5,color:"text.secondary",fontSize:"1.25rem"}})}}),e.jsxs(m,{display:"flex",gap:2,sx:{"& > *":{flex:1}},children:[e.jsx(C,{name:"ciudad",label:"Ciudad",fullWidth:!0,value:a.ciudad,onChange:l,disabled:i,sx:u,InputProps:{startAdornment:e.jsx(o,{icon:"mdi:map-marker",sx:{mr:1.5,color:"text.secondary",fontSize:"1.25rem"}})}}),e.jsx(C,{name:"salario",label:"Salario Ofrecido (opcional)",fullWidth:!0,value:a.salario,onChange:l,disabled:i,sx:u,InputProps:{startAdornment:e.jsx(o,{icon:"mdi:cash",sx:{mr:1.5,color:"text.secondary",fontSize:"1.25rem"}})}})]}),e.jsx(C,{name:"requisitos",label:"Requisitos de la vacante",fullWidth:!0,multiline:!0,rows:4,value:a.requisitos,onChange:l,disabled:i,sx:{...u,"& .MuiOutlinedInput-root":{...u["& .MuiOutlinedInput-root"],alignItems:"flex-start","& textarea":{minHeight:"100px"}}},InputProps:{startAdornment:e.jsx(o,{icon:"mdi:format-list-checks",sx:{mt:1.5,mr:1.5,color:"text.secondary",fontSize:"1.25rem",alignSelf:"flex-start"}})}})]})})},ee=()=>{const[x,b]=r.useState([]),[f,h]=r.useState(!0),[c,p]=r.useState(null),[a,d]=r.useState(!1),i=async()=>{h(!0),p(null);try{const t=await I.get("/vacancies");b(t.data)}catch(t){console.error("Error al obtener las vacantes:",t),p("No se pudieron cargar las vacantes. Por favor, recargue la p치gina.")}finally{h(!1)}};r.useEffect(()=>{i()},[]);const g=[{field:"cargo_solicitado",headerName:"Cargo",flex:2,minWidth:200},{field:"postulaciones_count",headerName:"Postulaciones",flex:1,minWidth:120,align:"center",headerAlign:"center"},{field:"estado",headerName:"Estado",flex:1,minWidth:120,renderCell:t=>{const l={Abierta:"success",Cerrada:"default",Pausada:"warning"};return e.jsx(D,{label:t.value,color:l[t.value]||"default",size:"small"})}},{field:"fecha_creacion",headerName:"Fecha de Creaci칩n",flex:1,minWidth:150,valueFormatter:t=>{if(!t||t.value===null||t.value===void 0)return"N/A";try{return new Date(t.value).toLocaleDateString()}catch(l){return console.error("Error al formatear la fecha:",l),"Fecha inv치lida"}}},{field:"actions",headerName:"Acciones",flex:1,minWidth:150,sortable:!1,renderCell:t=>e.jsx(_,{variant:"outlined",size:"small",component:O,to:`/CRM/vacancies/${t.row.id_vacante}/pipeline`,children:"Ver Pipeline"})}],j=()=>{i()};return e.jsxs(m,{p:3.5,children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(w,{variant:"h4",children:"Gesti칩n de Vacantes"}),e.jsx(_,{variant:"contained",startIcon:e.jsx(o,{icon:"mdi:plus"}),onClick:()=>d(!0),children:"Nueva Vacante"})]}),f&&e.jsx(m,{display:"flex",justifyContent:"center",mt:5,children:e.jsx(F,{})}),c&&e.jsx(A,{severity:"error",sx:{mt:2},children:c}),!f&&!c&&e.jsx(m,{sx:{height:600,width:"100%"},children:e.jsx(T,{rows:x,columns:g,getRowId:t=>t.id_vacante,initialState:{pagination:{paginationModel:{page:0,pageSize:10}}},pageSizeOptions:[5,10,20],checkboxSelection:!0,disableRowSelectionOnClick:!0})}),e.jsx(B,{open:a,onClose:()=>d(!1),onSuccess:j})]})};export{ee as default};
