import{r as i,j as e,S as b,F as M,i as N,k as V,M as k,h as p,B as v,T as q,b as S,I as F,C as A,m as P}from"./index-DhQHNqrp.js";import{a as j}from"./api-B5d2cEzN.js";import{u as L}from"./ToastContext-C4WtvxB4.js";import{M as O}from"./ModalWrapper-Cw9864jx.js";import{A as y}from"./Alert-dNxEE7vt.js";import{D as R}from"./DataGrid-DhyTyuOy.js";import{C as T}from"./Chip-D9c2OCYE.js";import"./ClickAwayListener-C8y_CwMB.js";import"./FormControlLabel-Bi2GVg1x.js";import"./TableCell-oRFRnvLi.js";const z=({open:c,onClose:x,onSuccess:m})=>{const{showToast:d}=L(),[n,u]=i.useState([]),[t,r]=i.useState({id_cliente:"",cargo_solicitado:"",ciudad:"",requisitos:"",salario:""}),[h,f]=i.useState(!1),[g,a]=i.useState(null);i.useEffect(()=>{c&&(async()=>{try{const o=await j.get("/clients");u(o.data||[])}catch{a("No se pudieron cargar los clientes.")}})()},[c]);const l=s=>{const{name:o,value:E}=s.target;r(I=>({...I,[o]:E}))},_=s=>{r(o=>({...o,id_cliente:s.target.value}))},w=async()=>{if(!t.id_cliente||!t.cargo_solicitado){a("El cliente y el cargo solicitado son obligatorios.");return}f(!0),a(null);try{await j.post("/vacancies",t),d("Vacante creada exitosamente.","success"),m(),C()}catch(s){a(s.message||"No se pudo crear la vacante."),d("Error al crear la vacante.","error")}finally{f(!1)}},C=()=>{r({id_cliente:"",cargo_solicitado:"",ciudad:"",requisitos:"",salario:""}),u([]),a(null),x()},W=[{label:"Cancelar",onClick:C,color:"inherit"},{label:"Crear Vacante",onClick:w,variant:"contained",disabled:h,loading:h}];return e.jsx(O,{title:"Crear Nueva Vacante",open:c,onClose:C,actions:W,children:e.jsxs(b,{spacing:2.5,sx:{mt:1},children:[g&&e.jsx(y,{severity:"error",children:g}),e.jsxs(M,{fullWidth:!0,required:!0,children:[e.jsx(N,{id:"client-select-label",children:"Cliente"}),e.jsx(V,{labelId:"client-select-label",value:t.id_cliente,label:"Cliente",onChange:_,disabled:n.length===0,children:n.map(s=>e.jsx(k,{value:s.id_cliente.toString(),children:s.empresa},s.id_cliente))})]}),e.jsx(p,{required:!0,autoFocus:!0,name:"cargo_solicitado",label:"Cargo Solicitado",fullWidth:!0,value:t.cargo_solicitado,onChange:l}),e.jsx(p,{name:"ciudad",label:"Ciudad",fullWidth:!0,value:t.ciudad,onChange:l}),e.jsx(p,{name:"salario",label:"Salario Ofrecido (opcional)",fullWidth:!0,value:t.salario,onChange:l}),e.jsx(p,{name:"requisitos",label:"Requisitos de la vacante",fullWidth:!0,multiline:!0,rows:4,value:t.requisitos,onChange:l})]})})},Y=()=>{const[c,x]=i.useState([]),[m,d]=i.useState(!0),[n,u]=i.useState(null),[t,r]=i.useState(!1),h=async()=>{d(!0),u(null);try{const a=await j.get("/vacancies");x(a.data)}catch(a){console.error("Error al obtener las vacantes:",a),u("No se pudieron cargar las vacantes. Por favor, recargue la página.")}finally{d(!1)}};i.useEffect(()=>{h()},[]);const f=[{field:"cargo_solicitado",headerName:"Cargo",flex:2,minWidth:200},{field:"postulaciones_count",headerName:"Postulaciones",flex:1,minWidth:120,align:"center",headerAlign:"center"},{field:"estado",headerName:"Estado",flex:1,minWidth:120,renderCell:a=>{const l={Abierta:"success",Cerrada:"default",Pausada:"warning"};return e.jsx(T,{label:a.value,color:l[a.value]||"default",size:"small"})}},{field:"fecha_creacion",headerName:"Fecha de Creación",flex:1,minWidth:150,valueFormatter:a=>new Date(a.value).toLocaleDateString()},{field:"actions",headerName:"Acciones",flex:1,minWidth:150,sortable:!1,renderCell:a=>e.jsx(S,{variant:"outlined",size:"small",component:P,to:`/CRM/vacancies/${a.row.id_vacante}/pipeline`,children:"Ver Pipeline"})}],g=()=>{h()};return e.jsxs(v,{p:3.5,children:[e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(q,{variant:"h4",children:"Gestión de Vacantes"}),e.jsx(S,{variant:"contained",startIcon:e.jsx(F,{icon:"mdi:plus"}),onClick:()=>r(!0),children:"Nueva Vacante"})]}),m&&e.jsx(v,{display:"flex",justifyContent:"center",mt:5,children:e.jsx(A,{})}),n&&e.jsx(y,{severity:"error",sx:{mt:2},children:n}),!m&&!n&&e.jsx(v,{sx:{height:600,width:"100%"},children:e.jsx(R,{rows:c,columns:f,getRowId:a=>a.id_vacante,initialState:{pagination:{paginationModel:{page:0,pageSize:10}}},pageSizeOptions:[5,10,20],checkboxSelection:!0,disableRowSelectionOnClick:!0})}),e.jsx(z,{open:t,onClose:()=>r(!1),onSuccess:g})]})};export{Y as default};
