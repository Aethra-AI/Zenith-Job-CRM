import{r as t,j as a,i as I,g as E,v as C,B as b,l as w,z as y,W as _,I as W}from"./index-D8abmwow.js";import{d as T}from"./dayjs.min-DPumIZBO.js";import{a as S}from"./api-D_anxX8K.js";import{u as k}from"./ToastContext-CjgFWFeE.js";import{M as z}from"./ModalWrapper-CvEYGRpM.js";import{A}from"./Alert-r8BKkBx-.js";import{C as D}from"./Chip-CwgSXf8l.js";import{D as F,T as B}from"./DataGrid-j-PmfbUS.js";import"./ClickAwayListener-Dr6xD1wL.js";import"./FormControlLabel-7TmQE7HR.js";import"./TableCell-BC9tei3J.js";const L=({open:g,onClose:x,postulationId:c,candidateName:u})=>{const{showToast:i}=k(),[s,n]=t.useState(""),[r,d]=t.useState(""),[p,h]=t.useState(""),[m,e]=t.useState(!1),[l,f]=t.useState(null),N=async()=>{if(!c||!s||!r){f("La fecha, hora y el nombre del entrevistador son obligatorios.");return}e(!0),f(null);const o={id_postulacion:c,fecha_hora:s,entrevistador:r,observaciones:p};try{const v=await S.post("/interviews",o);i(v.data.message||"Entrevista agendada con éxito.","success"),j(!0)}catch(v){f(v.message||"No se pudo agendar la entrevista."),i(v.message||"Error al agendar la entrevista.","error")}finally{e(!1)}},j=(o=!1)=>{n(""),d(""),h(""),f(null),x(o)},M=[{label:"Cancelar",onClick:()=>j(!1),color:"inherit"},{label:"Agendar Entrevista",onClick:N,variant:"contained",disabled:m,loading:m}];return a.jsx(z,{title:"Agendar Nueva Entrevista",open:g,onClose:()=>j(!1),actions:M,children:a.jsxs(I,{spacing:2.5,sx:{mt:1},children:[a.jsxs(E,{children:["Agendando entrevista para: ",a.jsx("strong",{children:u||"Candidato"})]}),l&&a.jsx(A,{severity:"error",children:l}),a.jsx(C,{label:"Fecha y Hora de la Entrevista",type:"datetime-local",fullWidth:!0,value:s,onChange:o=>n(o.target.value),InputLabelProps:{shrink:!0},autoFocus:!0,required:!0}),a.jsx(C,{label:"Nombre del Entrevistador",fullWidth:!0,value:r,onChange:o=>d(o.target.value),required:!0}),a.jsx(C,{label:"Observaciones (Enlace de Meet, etc.)",fullWidth:!0,multiline:!0,rows:4,value:p,onChange:o=>h(o.target.value),placeholder:"Añade detalles adicionales aquí..."})]})})},Q=()=>{const[g,x]=t.useState([]),[c,u]=t.useState(!0),[i,s]=t.useState(null),[n,r]=t.useState({open:!1,postulationId:null,candidateName:null}),d=async()=>{u(!0),s(null);try{const e=await S.get("/applications");x(e.data||[])}catch(e){console.error("Error al obtener las postulaciones:",e),s("No se pudieron cargar las postulaciones.")}finally{u(!1)}};t.useEffect(()=>{d()},[]);const p=(e,l)=>{r({open:!0,postulationId:e,candidateName:l})},h=(e=!1)=>{r({open:!1,postulationId:null,candidateName:null}),e&&d()},m=[{field:"nombre_candidato",headerName:"Candidato",flex:1.5,minWidth:180,renderCell:e=>a.jsx(w,{component:y,to:`/candidates/profile/${e.row.id_afiliado}`,size:"small",variant:"text",children:e.value})},{field:"cargo_vacante",headerName:"Vacante Aplicada",flex:1.5,minWidth:180,renderCell:e=>a.jsx(w,{component:y,to:`/vacancies/${e.row.id_vacante}/pipeline`,size:"small",variant:"text",color:"secondary",children:e.value})},{field:"estado",headerName:"Estado Actual",flex:1,minWidth:150,renderCell:e=>{const l={Recibida:"info","En Proceso":"secondary","En Entrevista":"warning",Rechazado:"error",Contratado:"success"};return a.jsx(D,{label:e.value,color:l[e.value]||"default",size:"small"})}},{field:"fecha_aplicacion",headerName:"Fecha de Postulación",flex:1,minWidth:180,valueFormatter:e=>T(e.value).format("DD [de] MMMM, YYYY")},{field:"actions",headerName:"Acciones",flex:1,minWidth:120,sortable:!1,align:"center",headerAlign:"center",renderCell:e=>a.jsx(B,{title:"Agendar Entrevista",children:a.jsx(_,{color:"primary",onClick:()=>p(e.row.id_postulacion,e.row.nombre_candidato),children:a.jsx(W,{icon:"mdi:calendar-plus"})})})}];return a.jsxs(a.Fragment,{children:[a.jsxs(b,{p:3.5,children:[a.jsx(E,{variant:"h4",gutterBottom:!0,children:"Todas las Postulaciones"}),i&&a.jsx(A,{severity:"error",sx:{mt:2,mb:2},children:i}),a.jsx(b,{sx:{height:"calc(100vh - 220px)",width:"100%"},children:a.jsx(F,{rows:g,columns:m,loading:c,getRowId:e=>e.id_postulacion,initialState:{pagination:{paginationModel:{page:0,pageSize:25}},sorting:{sortModel:[{field:"fecha_aplicacion",sort:"desc"}]}},pageSizeOptions:[10,25,50],disableRowSelectionOnClick:!0})})]}),a.jsx(L,{open:n.open,onClose:h,postulationId:n.postulationId,candidateName:n.candidateName})]})};export{Q as default};
