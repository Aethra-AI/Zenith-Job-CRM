import{m as R,n as V,r,o as G,c as U,_ as E,j as e,s as H,p as K,q as $,P as J,i as b,v as P,F as q,w as O,x as W,M as I,B as y,y as Q,l as v,h as k,g as f,k as X,I as M,z as Y}from"./index-Bn8KBKwd.js";import{a as w}from"./api-D_anxX8K.js";import{C as N}from"./Chip-6KSdwX_K.js";import{F as Z,C as ee}from"./FormControlLabel-BND9gM2X.js";import{u as D}from"./ToastContext-DLKLeNzj.js";import{M as se,D as ae,a as te,b as re,c as ne}from"./ModalWrapper-Ccu7U9fs.js";import{A as z}from"./Alert-CFAt4psY.js";import{C as oe,a as ie}from"./CardContent-CodeucTb.js";import{G as T}from"./Grid-DaJJ7bx8.js";import"./ClickAwayListener-Chr6gdoV.js";function le(s){return R("MuiCardActions",s)}V("MuiCardActions",["root","spacing"]);const ce=["disableSpacing","className"],de=s=>{const{classes:n,disableSpacing:o}=s;return $({root:["root",!o&&"spacing"]},le,n)},ue=H("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,n)=>{const{ownerState:o}=s;return[n.root,!o.disableSpacing&&n.spacing]}})(({ownerState:s})=>E({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),he=r.forwardRef(function(n,o){const i=G({props:n,name:"MuiCardActions"}),{disableSpacing:x=!1,className:g}=i,u=U(i,ce),l=E({},i,{disableSpacing:x}),p=de(l);return e.jsx(ue,E({className:K(p.root,g),ownerState:l,ref:o},u))}),xe=({filters:s,setFilters:n,onSearch:o,availableTags:i,loading:x})=>{const g=t=>{n(a=>({...a,q:t.target.value}))},u=t=>{const a=t.target.value;n(c=>({...c,tags:typeof a=="string"?a.split(","):a}))},l=t=>{n(a=>({...a,registered_today:t.target.checked}))},p=t=>{t.key==="Enter"&&o()};return e.jsx(J,{elevation:3,sx:{p:2,mb:3},children:e.jsxs(b,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",children:[e.jsx(P,{fullWidth:!0,label:"Buscar por nombre, empresa, etc.",variant:"outlined",value:s.q,onChange:g,onKeyPress:p,sx:{flexGrow:2}}),e.jsxs(q,{fullWidth:!0,sx:{flexGrow:1},children:[e.jsx(O,{children:"Tags"}),e.jsx(W,{multiple:!0,value:s.tags,onChange:u,input:e.jsx(Q,{label:"Tags"}),renderValue:t=>e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(a=>{var m;const c=((m=i.find(C=>C.id_tag.toString()===a))==null?void 0:m.nombre_tag)||a;return e.jsx(N,{label:c},a)})}),children:i.map(t=>e.jsx(I,{value:t.id_tag.toString(),children:t.nombre_tag},t.id_tag))})]}),e.jsx(Z,{control:e.jsx(ee,{checked:s.registered_today,onChange:l}),label:"Registrados Hoy"}),e.jsx(v,{variant:"contained",onClick:o,disabled:x,sx:{minWidth:120,height:56},children:x?"Buscando...":"Buscar"})]})})},ge=({open:s,onClose:n,candidateId:o,candidateName:i})=>{const{showToast:x}=D(),[g,u]=r.useState([]),[l,p]=r.useState(""),[t,a]=r.useState(""),[c,m]=r.useState(!1),[C,d]=r.useState(null);r.useEffect(()=>{s&&(async()=>{m(!0),d(null);try{const S=await w.get("/vacancies/active");u(S.data||[])}catch{d("No se pudieron cargar las vacantes activas.")}finally{m(!1)}})()},[s]);const h=j=>p(j.target.value),B=j=>a(j.target.value),L=async()=>{var S;if(!l){d("Por favor, selecciona una vacante.");return}m(!0),d(null);const j={id_afiliado:o,id_vacante:Number(l),comentarios:t};try{const _=await w.post("/applications",j);x(((S=_.data)==null?void 0:S.message)||"Postulación registrada con éxito.","success"),A()}catch(_){d(_.message||"No se pudo registrar la postulación."),x(_.message||"Error al registrar la postulación.","error")}finally{m(!1)}},A=()=>{p(""),a(""),u([]),d(null),n()},F=[{label:"Cancelar",onClick:A,color:"inherit"},{label:"Registrar Postulación",onClick:L,variant:"contained",disabled:c,loading:c}];return e.jsx(se,{title:"Postular Candidato",open:s,onClose:A,actions:F,children:c&&!g.length?e.jsx(y,{sx:{display:"flex",justifyContent:"center",my:3},children:e.jsx(k,{})}):e.jsxs(b,{spacing:2.5,sx:{mt:1},children:[e.jsxs(f,{children:["Postulando a: ",e.jsx("strong",{children:i||"Candidato"})]}),C&&e.jsx(z,{severity:"error",children:C}),e.jsxs(q,{fullWidth:!0,required:!0,children:[e.jsx(O,{id:"vacancy-select-label",children:"Vacante Activa"}),e.jsx(W,{labelId:"vacancy-select-label",value:l,label:"Vacante Activa",onChange:h,children:g.map(j=>e.jsx(I,{value:j.id.toString(),children:j.puesto},j.id))})]}),e.jsx(P,{label:"Comentarios (opcional)",fullWidth:!0,multiline:!0,rows:3,value:t,onChange:B})]})})},pe=({open:s,onClose:n,candidateId:o,candidateName:i,currentObservations:x})=>{const{showToast:g}=D(),[u,l]=r.useState(""),[p,t]=r.useState(!1),[a,c]=r.useState(null);r.useEffect(()=>{s&&l(x||"")},[s,x]);const m=h=>{l(h.target.value)},C=async()=>{if(!o){c("ID de candidato no válido.");return}t(!0),c(null);try{await w.put(`/candidate/profile/${o}`,{observaciones:u}),g("Observaciones guardadas con éxito.","success"),d(!0)}catch(h){c(h.message||"No se pudieron guardar las observaciones."),g("Error al guardar las observaciones.","error")}finally{t(!1)}},d=(h=!1)=>{l(""),c(null),n(h)};return e.jsxs(ae,{open:s,onClose:()=>d(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(te,{children:"Editar Observaciones"}),e.jsx(re,{children:e.jsxs(b,{spacing:2.5,sx:{mt:2},children:[e.jsxs(f,{children:["Editando notas para: ",e.jsx("strong",{children:i||"Candidato Desconocido"})]}),a&&e.jsx(z,{severity:"error",children:a}),e.jsx(P,{label:"Observaciones",fullWidth:!0,multiline:!0,rows:10,value:u,onChange:m,placeholder:"Añade tus notas sobre el candidato aquí...",autoFocus:!0})]})}),e.jsxs(ne,{sx:{p:"16px 24px"},children:[e.jsx(v,{onClick:()=>d(!1),color:"inherit",children:"Cancelar"}),e.jsx(v,{onClick:C,variant:"contained",disabled:p,children:p?e.jsx(k,{size:24,color:"inherit"}):"Guardar Cambios"})]})]})},me=({candidate:s,onDataChange:n})=>{const[o,i]=r.useState(!1),[x,g]=r.useState(!1),u=s.tags?s.tags.split(",").map(a=>a.trim()):[],l=`/candidates/profile/${s.id_afiliado}`,p=()=>{g(!0)},t=(a=!1)=>{g(!1),a&&n()};return e.jsxs(e.Fragment,{children:[e.jsxs(oe,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(ie,{sx:{flexGrow:1},children:[e.jsxs(b,{direction:"row",spacing:2,alignItems:"center",mb:2,children:[e.jsx(X,{sx:{width:56,height:56,bgcolor:"primary.light"},children:s.nombre_completo.charAt(0)}),e.jsxs(y,{children:[e.jsx(f,{variant:"h6",component:"div",noWrap:!0,children:s.nombre_completo}),e.jsx(f,{sx:{mb:1.5},color:"text.secondary",children:s.ciudad||"Ciudad no especificada"})]})]}),e.jsxs(b,{direction:"row",alignItems:"center",spacing:1,color:"text.secondary",mb:2,children:[e.jsx(M,{icon:"ph:phone-fill"}),e.jsx(f,{variant:"body2",children:s.telefono})]}),e.jsxs(y,{children:[e.jsx(f,{variant:"subtitle2",gutterBottom:!0,children:"Tags:"}),e.jsx(b,{direction:"row",useFlexGap:!0,flexWrap:"wrap",spacing:1,children:u.length>0?u.map((a,c)=>e.jsx(N,{label:a,size:"small"},c)):e.jsx(f,{variant:"caption",color:"text.secondary",children:"Sin tags asignados"})})]})]}),e.jsxs(he,{sx:{display:"flex",justifyContent:"space-between",p:2,pt:1,borderTop:1,borderColor:"divider"},children:[e.jsx(v,{size:"small",variant:"contained",color:"success",startIcon:e.jsx(M,{icon:"mdi:paper-plane"}),onClick:()=>i(!0),children:"Postular"}),e.jsxs(b,{direction:"row",spacing:1,children:[e.jsx(v,{size:"small",variant:"outlined",color:"secondary",onClick:p,children:"Notas"}),e.jsx(v,{size:"small",variant:"outlined",component:Y,to:l,children:"Perfil"})]})]})]}),e.jsx(ge,{open:o,onClose:()=>i(!1),candidateId:s.id_afiliado,candidateName:s.nombre_completo}),e.jsx(pe,{open:x,onClose:t,candidateId:s.id_afiliado,candidateName:s.nombre_completo,currentObservations:s.observaciones})]})},Ee=()=>{const[s,n]=r.useState({q:"",tags:[],registered_today:!1}),[o,i]=r.useState([]),[x,g]=r.useState([]),[u,l]=r.useState(!1),[p,t]=r.useState(null),[a,c]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const h=await w.get("/tags");g(h.data||[])}catch(h){console.error("Error al cargar los tags:",h)}})()},[]);const m=r.useCallback(async()=>{l(!0),t(null),c(!0);const d={q:s.q,tags:s.tags.join(","),registered_today:s.registered_today};try{const h=await w.get("/candidates/search",{params:d});i(h.data||[])}catch(h){console.error("Error en la búsqueda de candidatos:",h),t("Ocurrió un error al realizar la búsqueda."),i([])}finally{l(!1)}},[s]),C=()=>u?e.jsx(y,{display:"flex",justifyContent:"center",mt:5,children:e.jsx(k,{size:50})}):p?e.jsx(f,{color:"error",textAlign:"center",mt:5,children:p}):a?o.length===0?e.jsx(f,{textAlign:"center",mt:5,children:"No se encontraron candidatos que coincidan con su búsqueda."}):e.jsx(T,{container:!0,spacing:3,children:o.map(d=>e.jsx(T,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(me,{candidate:d,onDataChange:m})},d.id_afiliado))}):e.jsx(f,{textAlign:"center",mt:5,children:"Utilice los filtros para comenzar una búsqueda de candidatos."});return e.jsxs(y,{p:3.5,children:[e.jsx(f,{variant:"h4",gutterBottom:!0,children:"Búsqueda de Candidatos"}),e.jsx(xe,{filters:s,setFilters:n,onSearch:m,availableTags:x,loading:u}),C()]})};export{Ee as default};
